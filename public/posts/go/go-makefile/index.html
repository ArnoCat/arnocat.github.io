<!DOCTYPE html>
<html lang="zh"
  x-data
  :class="$store.darkMode.class()"
  :data-theme="$store.darkMode.theme()">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>go-makefile | Arno</title>

    
<link href="/img/favicon.ico" rel="shortcut icon" type="image/x-icon" />




<meta name="author" content="Author Name" />
<meta name="description" content="Using Makefile for Go - Goè¯­è¨€é¡¹ç›®å¦‚ä½•æ­£ç¡®ä½¿ç”¨Makefile æˆ‘ä»¬ä¸€ç›´åœ¨ç”¨Goè¯­è¨€ç¼–å†™çš„HackerRanké¡¹ç›®ä¸­çš„ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨makeä½œä¸ºæ„å»ºå·¥å…·ï¼Œå¹¶" />


<link rel="canonical" href="https://arnocat.github.io/posts/go/go-makefile/" />


<meta property="og:url" content="https://arnocat.github.io/posts/go/go-makefile/">
  <meta property="og:site_name" content="Arno">
  <meta property="og:title" content="go-makefile">
  <meta property="og:description" content="Using Makefile for Go - Goè¯­è¨€é¡¹ç›®å¦‚ä½•æ­£ç¡®ä½¿ç”¨Makefile æˆ‘ä»¬ä¸€ç›´åœ¨ç”¨Goè¯­è¨€ç¼–å†™çš„HackerRanké¡¹ç›®ä¸­çš„ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨makeä½œä¸ºæ„å»ºå·¥å…·ï¼Œå¹¶">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-18T16:44:54+08:00">
    <meta property="article:modified_time" content="2024-07-18T16:44:54+08:00">
    <meta property="article:tag" content="Tag1">
    <meta property="article:tag" content="Tag2">




  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="go-makefile">
  <meta name="twitter:description" content="Using Makefile for Go - Goè¯­è¨€é¡¹ç›®å¦‚ä½•æ­£ç¡®ä½¿ç”¨Makefile æˆ‘ä»¬ä¸€ç›´åœ¨ç”¨Goè¯­è¨€ç¼–å†™çš„HackerRanké¡¹ç›®ä¸­çš„ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨makeä½œä¸ºæ„å»ºå·¥å…·ï¼Œå¹¶">



<meta name="generator" content="Hugo 0.128.2">

<link rel="stylesheet" href="/css/output.css" />

<style>

#dream-global-bg {
  background-image: url(/background.jpg);
}



</style>


    


<link rel="stylesheet" data-custom-syntax-highlighting />
<style>
  .chroma {
    padding: 1em;
    background-color: var(--dream-pre-bg, #f5f5f5);
    border-radius: .5em;
    overflow: auto;
  }

  html.dark .chroma {
    background-color: var(--dream-pre-bg-dark, #262626);
  }
</style>






    

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>

  <body x-data="{
    flip: false,
  }">
    
    <div id="dream-global-bg"></div>

    
<nav class="mt-4 lg:mt-8 pt-4 pb-4">

  <div class="container flex justify-between px-4">
    <section class="flex items-center gap-4">
      <div class="avatar cursor-pointer hover:online" @click="flip = !flip" title="ç¿»è½¬ï¼">
        <div class="h-10 rounded-full">
          <img src="/img/avatar.png" alt="arno cat home" />
        </div>
      </div>

      
      <div>
        
        <a href="https://arnocat.github.io/" class="text-lg font-semibold cursor-pointer">
          arno cat home
        </a>
        
        
        <div class="text-base-content/60 text-sm">ä¸å…¶æ„Ÿæ…¨è·¯éš¾è¡Œï¼Œä¸å¦‚é©¬ä¸Šå‡ºå‘</div>
        
      </div>
      
    </section>

    <div class="dropdown dropdown-end sm:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-square">
        <ion-icon name="menu-outline" size="large"></ion-icon>
      </div>
      <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow">
        


<li>
  <div role="link" tabindex="0" class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title="å…³äº">
    <ion-icon name="information-circle"></ion-icon>å…³äº</div>
</li>




<li>
  <a class="group inline-flex items-center p-2 cursor-pointer" href="/search" title="æœç´¢">
    <ion-icon name="search"></ion-icon>
    æœç´¢
  </a>
</li>



<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/posts" title="å½’æ¡£">
    <ion-icon name="archive"></ion-icon>
    å½’æ¡£
  </a>
</li>



<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/categories" title="æ‰€æœ‰åˆ†ç±»">
    <ion-icon name="grid"></ion-icon>
    æ‰€æœ‰åˆ†ç±»
  </a>
</li>



<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/tags" title="æ‰€æœ‰æ ‡ç­¾">
    <ion-icon name="pricetags"></ion-icon>
    æ‰€æœ‰æ ‡ç­¾
  </a>
</li>



<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/index.xml" title="RSS">
    <ion-icon name="logo-rss"></ion-icon>
    RSS
  </a>
</li>


      </ul>
    </div>
    <section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4">
      
      
      
      <div role="link" tabindex="0" class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title="å…³äº">å…³äº</div>
      
      

      
      <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/search" title="æœç´¢">
        <ion-icon class="group-hover:text-primary-content" name="search"></ion-icon>
      </a>
      

      
      <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/posts" title="å½’æ¡£">
        <ion-icon class="group-hover:text-primary-content" name="archive"></ion-icon>
      </a>
      

      
      <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/categories" title="æ‰€æœ‰åˆ†ç±»">
        <ion-icon class="group-hover:text-primary-content" name="grid"></ion-icon>
      </a>
      

      
      <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/tags" title="æ‰€æœ‰æ ‡ç­¾">
        <ion-icon class="group-hover:text-primary-content" name="pricetags"></ion-icon>
      </a>
      

      
      <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/index.xml" title="RSS">
        <ion-icon class="group-hover:text-primary-content" name="logo-rss"></ion-icon>
      </a>
      
    </section>
  </div>
</nav>


    <div class="flip-container" :class="{ 'flip-it': flip }">
      <div class="flipper">
        <section class="front">
          <div class="container">
            
<div class="mt-4 px-4">
  <section class="mx-auto prose dark:prose-invert" id="dream-single-page">
    <header>
      <h1>go-makefile</h1>
      <p class="text-sm">
        
          <span data-format="luxon">2024-07-18T16:44:54&#43;08:00</span>
        

        | <span>7 åˆ†é’Ÿé˜…è¯»</span>

        
        | <span>æ›´æ–°äº
          
            <span data-format="luxon">2024-07-18T16:44:54&#43;08:00</span>
          </span>
        
      </p>
      <div class="flex justify-between">
        <div class="flex items-center">
  
  <span>@</span>
  

  <span>
  
    
      Author Name
    
  
  </span>
</div>


        <span class="flex items-center gap-2">
  <a class="group inline-flex items-center p-2 text-sm rounded-full cursor-pointer hover:bg-primary" href="https://twitter.com/intent/tweet?text=go-makefile&url=https%3a%2f%2farnocat.github.io%2fposts%2fgo%2fgo-makefile%2f" title="Share on X">
    <ion-icon class="group-hover:text-primary-content" name="logo-x"></ion-icon>
  </a>
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2farnocat.github.io%2fposts%2fgo%2fgo-makefile%2f" title="Share on Facebook">
    <ion-icon class="group-hover:text-primary-content" name="logo-facebook"></ion-icon>
  </a>
</span>

      </div>
    </header>

    <main>
      

      <h2 id="using-makefile-for-go---goè¯­è¨€é¡¹ç›®å¦‚ä½•æ­£ç¡®ä½¿ç”¨makefile">Using Makefile for Go - Goè¯­è¨€é¡¹ç›®å¦‚ä½•æ­£ç¡®ä½¿ç”¨Makefile</h2>
<p>æˆ‘ä»¬ä¸€ç›´åœ¨ç”¨Goè¯­è¨€ç¼–å†™çš„HackerRanké¡¹ç›®ä¸­çš„ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨makeä½œä¸ºæ„å»ºå·¥å…·ï¼Œå¹¶ä¸”æ•ˆæœè‰¯å¥½ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æŒ‡å‡ºæˆ‘ä»¬ä½¿ç”¨çš„GNU Makeçš„ä¸€äº›åŠŸèƒ½å’Œå¤æ‚æ€§ï¼Œè¿™äº›åŠŸèƒ½å’Œå¤æ‚æ€§æœ€ç»ˆæé«˜äº†æˆ‘ä»¬å›¢é˜Ÿæˆå‘˜çš„æ•´ä½“ç”Ÿäº§åŠ›ã€‚</p>
<p>å‰è¨€
make æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œå®ƒå¯ä»¥æ£€æµ‹å¤§å‹é¡¹ç›®çš„å“ªä¸ªéƒ¨åˆ†éœ€è¦é‡æ–°ç¼–è¯‘å’Œæ‰§è¡Œç”¨æˆ·å®šä¹‰çš„å‘½ä»¤ç¼–è¯‘æˆ–æ˜¯å…¶ä»–éœ€è¦çš„æ“ä½œã€‚å®ƒä¹Ÿå¹¿æ³›ç”¨ä½œæ„å»ºå·¥å…·ï¼Œ æ‚¨å¯ä»¥åœ¨å…¶ä¸­æŒ‡å®šè¦è¿è¡Œçš„ä¸€ç»„å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æœ¬æ¥æ˜¯ç”¨æ¥åœ¨å‘½ä»¤è¡Œä¸Šç¼–å†™çš„ï¼Œé€šå¸¸æ˜¯é‡å¤å¤šæ¬¡æ‰§è¡Œã€‚ä¸‹é¢æ˜¯æœ¬æ–‡å…¶ä½™éƒ¨åˆ†çš„ä¸»è¦å†…å®¹ã€‚</p>
<p>ä¸ºäº†è¿™ç¯‡æ–‡ç« çš„ç›®çš„ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æ­£åœ¨ä»äº‹GOé¡¹ç›®stringifier , è€Œä¸”å°†ä¼šç¼–å†™ä¸€ä¸ªMakefile, ä¹Ÿç§°ä¸ºMakefileã€‚</p>
<p>Build and Run
Goç¨‹åºçš„è¿™ä¸¤ä¸ªæŒ‡ä»¤ä½¿ç”¨çš„ç›¸å½“é¢‘ç¹, æ‰€ä»¥æ·»åŠ è¿™äº›ç›®å½•è‡³æˆ‘ä»¬çš„Makefile:</p>
<p>build:
go build -o stringifier main.go</p>
<p>run:
go run -race main.go
æˆ‘åœ¨è¿è¡Œå‘½ä»¤ä¸­æ·»åŠ äº†-raceæ ‡å¿—ï¼Œæ–¹ä¾¿å®ƒåœ¨è¿è¡Œæ—¶åœ¨Goä»£ç ä¸­æ£€æµ‹åˆ°raceæƒ…å†µã€‚</p>
<p>Cleaning and DRYing
æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶å¹¶è¿è¡Œåº”ç”¨ç¨‹åºåï¼Œä¸€åˆ‡æ­£å¸¸, ç¡®ä¿æˆ‘ä»¬åœ¨æ‰§è¡Œå…¶ä»–ä»»ä½•æ“ä½œä¹‹å‰å…ˆæ¸…ç†äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æˆ‘ä»¬æ›´æ–°Makefileåº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p>build:
go build -o stringifier main.go</p>
<p>run:
go run -race main.go</p>
<p>clean:
go clean</p>
<p>æˆ‘ä»¬æœ‰ä¸¤ç‚¹å¯ä»¥æ”¹è¿›ï¼Œ</p>
<p>æˆ‘ä»¬æ˜ç¡®åœ°é‡ç”¨äº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå, å¾ˆè‡ªç„¶æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåç§°å°†åœ¨æ•´ä¸ªMakefileä¸­çš„è®¸å¤šåœ°æ–¹ä½¿ç”¨ã€‚
æ¯æ¬¡æ„å»ºåº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰§è¡Œcleançš„è§„åˆ™ã€‚
æ”¹è¿›åçš„Makefile</p>
<p>APP=stringifier</p>
<p>build: clean
go build -o ${APP} main.go</p>
<p>run:
go run -race main.go</p>
<p>clean:
go clean</p>
<p>æ›´æ–°: è¿™ä¸ªä¾‹å­ä¹‹å‰ä½¿ç”¨çš„rm -r ${APP}ï¼Œ ä½†æ˜¯æ„Ÿè°¢è®²è€…çš„å»ºè®®ï¼Œç°åœ¨ä½¿ç”¨go cleanã€‚</p>
<p>åœ¨é¡¶éƒ¨å®šä¹‰Makefileå˜é‡ï¼Œå½“æ‚¨è°ƒç”¨makeå‘½ä»¤æ—¶makeå°†è‡ªåŠ¨å¼•ç”¨å®ƒä»¬ï¼Œè¿™æ ·Makefileçœ‹èµ·æ¥å°±æ›´æ•´æ´ã€è§„èŒƒäº†ã€‚</p>
<p>PHONY targets
é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªå‰ç½®æ¡ä»¶æˆ–æ˜¯ç›®å½•æ–‡ä»¶å·²æ›´æ”¹ï¼Œmakeå°†æ‰§è¡Œè§„åˆ™ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬ä¸ä¾èµ–äºmakeæ¥æ£€æµ‹æ–‡ä»¶æ›´æ”¹çš„èƒ½åŠ›ï¼Œå› æ­¤æˆ‘ä»¬ä¼šé‡åˆ°æ½œåœ¨çš„éº»çƒ¦ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬çš„é¡¹ç›®ç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸ºbuildçš„æ–‡ä»¶, åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œå½“ä½ æ‰§è¡Œmake build, makeä¸€å®šä¼šæ£€æŸ¥æ–‡ä»¶buildçš„æ›´æ”¹ï¼Œç”±äºæ²¡æœ‰å‰ç½®æ¡ä»¶ï¼Œå› æ­¤å°†å§‹ç»ˆå°†buildæ–‡ä»¶è§†ä¸ºæœ€æ–°çš„ï¼Œå¹¶ä¸”ä¸ä¼šæ‰§è¡Œå…¶è§„åˆ™å®šä¹‰çš„æ“ä½œã€‚</p>
<p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦å…ˆçŸ¥é“.PHONY ç‰¹æ®Šç›®å½•(target)æ˜¯ä»€ä¹ˆæ„æ€ï¼šç‰¹æ®Šç›®æ ‡.PHONYçš„å…ˆå†³æ¡ä»¶è¢«è§†ä¸ºphonyç›®æ ‡ï¼ˆtargets)ã€‚ å½“éœ€è¦è¿è¡Œæ—¶ï¼Œmakeä¼šæ— æ¡ä»¶è¿è¡Œå…¶è§„åˆ™ï¼Œè€Œä¸ç®¡è¯¥åç§°çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨æˆ–å…¶æœ€åä¿®æ”¹æ—¶é—´æ˜¯å¤šå°‘ã€‚</p>
<p>æ‰€ä»¥ï¼Œä½ å¯ä»¥é€šè¿‡å°†ç›®æ ‡ï¼ˆtargetï¼‰æŒ‡å®šä¸ºç‰¹æ®Šç›®æ ‡.PHONYçš„å…ˆå†³æ¡ä»¶ï¼Œå°†ç›®æ ‡æŒ‡å®šä¸º.PHONYã€‚</p>
<p>APP=stringifier</p>
<p>.PHONY: build
build: clean
go build -o ${APP} main.go</p>
<p>.PHONY: run
run:
go run -race main.go</p>
<p>.PHONY: clean
clean:
go clean
ç°åœ¨ä½ å·²å°†ä¸Šè¿°æ‰€æœ‰çš„targetsæŒ‡å®šä¸ºphony, æ¯æ¬¡ä½ è°ƒç”¨ä»»ä½•phonyç›®æ ‡ï¼ˆtarget) æ—¶ï¼Œmakeå°†ä¼šæ‰§è¡Œç›¸åº”çš„è§„åˆ™ã€‚ä½ è¿˜å¯ä»¥ä¸€æ¬¡å°†æ‰€æœ‰è¦æŒ‡å®šä¸ºphonyçš„ç›®æ ‡æŒ‡å®šä¸º:</p>
<p>.PHONY: build clean run
ä½†æ˜¯å¯¹äºéå¸¸å¤§çš„Makefileï¼Œä¸å»ºè®®è¿™æ ·åšå› ä¸ºè¿™å¯èƒ½å¯¼è‡´æ­§ä¹‰å’Œæ— æ³•è¯»å–ã€‚å› æ­¤ï¼Œé¦–é€‰æ–¹æ³•æ˜¯åœ¨è§„åˆ™å®šä¹‰ä¹‹å‰æ˜¾å¼è®¾ç½®phonyç›®æ ‡ï¼ˆtargetï¼‰ã€‚</p>
<p>Recursive Make targets
ç°åœ¨è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ ¹ç›®å½•ä¸­è¿˜æœ‰å¦ä¸€ä¸ªæ¨¡å—tokenizerã€‚ç°åœ¨æˆ‘ä»¬çš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>
<p>~/programming/stringifier
.
â”œâ”€â”€ main.go
â”œâ”€â”€ Makefile
â””â”€â”€ tokenizer/
â”œâ”€â”€ main.go
â””â”€â”€ Makefile
å¾ˆè‡ªç„¶ï¼ŒæŸäº›æ—¶å€™æˆ‘ä»¬ä¹Ÿæƒ³buildå’Œtestæˆ‘ä»¬çš„tokenizeræ¨¡å—ã€‚ç”±äºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œåœ¨å®ƒçš„ç›®å½•æœ‰å¦‚ä¸‹å†…å®¹çš„ä¸€ä¸ªMakefileæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼š</p>
<h2 id="programmingstringifiertokenizermakefile">~/programming/stringifier/tokenizer/Makefile</h2>
<p>APP=tokenizer</p>
<p>build:
go build -o ${APP} main.go
ç°åœ¨åªè¦æ‚¨åœ¨stringifieré¡¹ç›®çš„æ ¹ç›®å½•ä¸­å¹¶ä¸”æƒ³è¦æ„å»ºtokenizeråº”ç”¨ç¨‹åºï¼Œä½ ä¸ä¼šæƒ³ä½¿ç”¨è¯¸å¦‚cd tokenizer &amp;&amp; make build &amp;&amp; cd - è¿™æ ·çš„æ˜“å—æ”»å‡»çš„å‘½ä»¤è¡ŒæŠ€å·§ï¼Œè€Œå…·ä½“çš„Makefilesçš„è§„åˆ™å†™åœ¨å­ç›®å½•ä¸­çš„æ–¹å¼ã€‚å¹¸è¿çš„æ˜¯ï¼Œmakeå¯ä»¥å¸®åŠ©ä½ è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ å¯ä»¥ä½¿ç”¨-Cæ ‡å¿—å’Œç‰¹æ®Šçš„${NAME}å˜é‡åœ¨å…¶ä»–ç›®å½•ä¸­è°ƒç”¨make targetsã€‚ä¸‹é¢æ˜¯stringifiesé¡¹ç›®æœ€åˆçš„Makefile:</p>
<h2 id="programmingstringifiermakefile">~/programming/stringifier/Makefile</h2>
<p>APP=stringifier</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SHELL" data-lang="SHELL"><span class="line"><span class="cl">.PHONY: build
</span></span><span class="line"><span class="cl">build: clean
</span></span><span class="line"><span class="cl"> go build -o <span class="si">${</span><span class="nv">APP</span><span class="si">}</span> main.go
</span></span></code></pre></div><p>.PHONY: run
run:
go run -race main.go</p>
<p>.PHONY: clean
clean:
go clean</p>
<p>.PHONY: build-tokenizer
build-tokenizer:
${MAKE} -C tokenizer build
ç°åœ¨åªè¦ä½ è¿è¡Œmake build-tokenizerï¼Œmakeéƒ½å°†ä¸ºæ‚¨å¤„ç†ç›®å½•åˆ‡æ¢ï¼Œå¹¶ä»¥æ›´åŠ å¯è¯»å’Œå¥å£®çš„æ–¹å¼ä¸ºæ‚¨è°ƒç”¨æ­£ç¡®ç›®å½•ä¸­çš„æ­£ç¡®ç›®æ ‡</p>
<p>Targets for Docker commands
ç°åœ¨æ‚¨å¸Œæœ›å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œå®¹å™¨åŒ–ï¼Œç„¶åä¸ºæ–¹ä¾¿èµ·è§ç¼–å†™makeç›®æ ‡ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥ç†è§£çš„ã€‚</p>
<p>ä½ ä¸ºdockerå‘½ä»¤å®šä¹‰äº†å¦‚ä¸‹è§„åˆ™ï¼š</p>
<p>.PHONY: docker-build
docker-build: build
docker build -t stringifier .
docker tag stringifier stringifier:tag</p>
<p>.PHONY: docker-push
docker-push: docker-build
docker push gcr.io/stringifier/stringifier-staging/stringifier:tag
dockerå‘½ä»¤åŸºæœ¬æ»¡è¶³éœ€è¦ï¼Œä½†æ˜¯è¿˜æœ‰æ”¹å–„çš„ç©ºé—´ï¼Œ</p>
<p>å¯¹äºæ–°æ‰‹ï¼Œä½ å¯ä»¥å†æ¬¡é‡ç”¨ä½ çš„${APP}å˜é‡ã€‚
æ¥ä¸‹æ¥ï¼Œæ‚¨æƒ³è¦æ›´çµæ´»å¹¶ç¡®ä¿å¯ä»¥è½»æ¾æ§åˆ¶å°†æ˜ åƒæ¨é€åˆ°å“ªé‡Œï¼Œæ— è®ºæ˜¯æ‚¨çš„ç§äººé•œåƒä»“åº“è¿˜æ˜¯å…¶ä»–åœ°æ–¹ã€‚
ç„¶åï¼Œæ‚¨å¸Œæœ›èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·åœ¨å‘½ä»¤è¡Œä¸Šçš„æŸäº›è¾“å…¥å°†é•œåƒï¼ˆimageï¼‰åˆ†åˆ«æ¨é€åˆ°ä¸é¢„ç”Ÿäº§å’Œç”Ÿäº§ç¯å¢ƒæœ‰å…³çš„ä¸¤ä¸ªå•ç‹¬çš„é•œåƒä»“åº“ä¸­ã€‚
æœ€åï¼Œåƒä¸€ä¸ªç†æ™ºçš„å¼€å‘äººå‘˜ä¸€æ ·ï¼Œæ‚¨æƒ³ä½¿ç”¨å½“å‰çš„git commit shaæ ‡è®°æ‚¨çš„é•œåƒï¼ˆimageï¼‰ã€‚ è®©æˆ‘ä»¬åŸºäºè¿™äº›é—®é¢˜é‡æ–°ä¿®æ”¹ä¸‹Makefileï¼š
APP?=application
REGISTRY?=gcr.io/images
COMMIT_SHA=$(shell git rev-parse &ndash;short HEAD)</p>
<p>.PHONY: docker-build
docker-build: build
docker build -t ${APP} .
docker tag ${APP} ${APP}:${COMMIT_SHA}</p>
<p>.PHONY: docker-push
docker-push: check-environment docker-build
docker push ${REGISTRY}/${ENV}/${APP}:${COMMIT_SHA}</p>
<p>check-environment:
ifndef ENV
$(error ENV not set, allowed values - <code>staging</code> or <code>production</code>)
endif</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸‹ä¸Šé¢çš„æ›´æ”¹ï¼š</p>
<p>ä½ å¼€å§‹ä¸ºåº”ç”¨ç¨‹åºåç§°ï¼Œé•œåƒåç§°,æäº¤shaä½¿ç”¨å˜é‡ã€‚
æ‚¨ä½¿ç”¨ç‰¹æ®Šçš„shellå‡½æ•°ç”Ÿæˆäº†commit shaã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è¿è¡Œäº†gitå‘½ä»¤ï¼Œè¯¥å‘½ä»¤è¿”å›äº†ç®€çŸ­çš„æäº¤shaï¼Œå¹¶å°†å…¶åˆ†é…ç»™å˜é‡${COMMIT_SHA}ï¼Œä»¥ä¾¿ç¨ååœ¨Makefileä¸­ä½¿ç”¨ã€‚
æ‚¨æ·»åŠ äº†ä¸€ä¸ªæ–°çš„è§„åˆ™check-environmentï¼Œè¯¥ç¯å¢ƒä½¿ç”¨makeæ¡ä»¶æ£€æŸ¥åœ¨è°ƒç”¨makeæ—¶æ˜¯å¦æŒ‡å®šäº†ENVå˜é‡ï¼Œè¿™æœ‰åŠ©äºåŒºåˆ†é¢„ç”Ÿäº§åŠç”Ÿäº§ç¯å¢ƒã€‚
check-environmentçš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<p>check-environment:
ifndef ENV
$(error ENV not set, allowed values - <code>staging</code> or <code>production</code>)
endif
ä½¿ç”¨ifndefæŒ‡ä»¤æ£€æŸ¥å˜é‡ENVæ˜¯å¦ä¸ºç©ºå€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä½¿ç”¨å¦ä¸€ä¸ªmakeçš„æä¾›å†…ç½®å‡½æ•°ï¼Œå¦‚æœå‡ºé”™äº†ï¼Œå°†ä¼šåœ¨å…³é”®å­—ä¹‹åæŠ›å‡ºå…·ä½“çš„é”™è¯¯æ¶ˆæ¯ã€‚</p>
<p>$ make docker-push
Makefile:33: *** ENV not set, allowed values - <code>staging</code> or <code>production</code>.  Stop.</p>
<p>$ ENV=staging make docker-push
Success
æœ¬è´¨ä¸Šï¼Œæ‚¨è¦ç¡®ä¿docker-pushç›®æ ‡å…·æœ‰å®‰å…¨ä¿éšœï¼Œè¯¥ä¿éšœå¯æ£€æŸ¥è°ƒç”¨ç›®æ ‡çš„ç”¨æˆ·æ˜¯å¦å·²ä¸ºENVå˜é‡æŒ‡å®šå€¼ã€‚</p>
<p>Help target
ä¸€ä¸ªæ–°æˆå‘˜åŠ å…¥äº†è¯¥é¡¹ç›®å¹¶æƒ³çŸ¥é“Makefileä¸­æ‰€æœ‰è§„åˆ™çš„ä½œç”¨ï¼Œä¸ºå¸®åŠ©å®ƒä»¬æ‚¨å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°ç›®æ ‡(target)ï¼Œè¯¥ç›®æ ‡å°†æ‰“å°æ‰€æœ‰ç›®æ ‡åç§°ä»¥åŠå®ƒä»¬ä½œç”¨çš„ç®€çŸ­æè¿°:</p>
<p>.PHONY: build</p>
<h2 id="build-build-the-application">build: build the application</h2>
<p>build: clean
@echo &ldquo;Building&hellip;&rdquo;
@go build -o ${APP} main.go</p>
<p>.PHONY: run</p>
<h2 id="run-runs-go-run-maingo">run: runs go run main.go</h2>
<p>run:
go run -race main.go</p>
<p>.PHONY: clean</p>
<h2 id="clean-cleans-the-binary">clean: cleans the binary</h2>
<p>clean:
@echo &ldquo;Cleaning&rdquo;
@go clean</p>
<p>.PHONY: setup</p>
<h2 id="setup-setup-go-modules">setup: setup go modules</h2>
<p>setup:
@go mod init <br>
&amp;&amp; go mod tidy <br>
&amp;&amp; go mod vendor</p>
<p>.PHONY: help</p>
<h2 id="help-prints-this-help-message">help: prints this help message</h2>
<p>help:
@echo &ldquo;Usage: \n&rdquo;
@sed -n &rsquo;s/^##//p&rsquo; ${MAKEFILE_LIST} | column -t -s &lsquo;:&rsquo; |  sed -e &rsquo;s/^/ /&rsquo;
ä½ å…ˆæ³¨æ„ä¸‹æœ€åä¸€æ¡è§„åˆ™ï¼Œhelp åœ¨è¿™é‡Œï¼Œæ‚¨åªæ˜¯ä½¿ç”¨ä¸€äº›sedé­”æœ¯æ¥è§£æå’Œåœ¨å‘½ä»¤è¡Œä¸Šæ‰“å°ã€‚ ä½†æ˜¯è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨å¿…è¦åœ¨æ¯æ¡è§„åˆ™ä¹‹å‰å†™äº†ç›®æ ‡åç§°å’Œç®€çŸ­æè¿°ä½œä¸ºæ³¨é‡Šã€‚ æ³¨æ„å¦ä¸€ä¸ªç‰¹æ®Šå˜é‡$ {MAKEFILE_LIST}ï¼Œå®ƒæ˜¯æ‚¨æ‰€å¼•ç”¨çš„æ‰€æœ‰Makefileçš„åˆ—è¡¨ï¼Œåœ¨æœ¬ä¾‹ä¸­ä»…æ˜¯Makefileã€‚</p>
<p>æ‚¨ä¼šå°†æ–‡ä»¶Makefileä½œä¸ºè¾“å…¥ä¼ é€’ç»™sedå‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†è§£ææ‰€æœ‰å¸®åŠ©æ³¨é‡Šå¹¶ä»¥è¡¨æ ¼æ ¼å¼å°†å…¶æ‰“å°åˆ°stdoutï¼Œä»¥ä¾¿äºé˜…è¯»ã€‚ ä¸Šä¸€ä¸ªä»£ç æ®µçš„helpç›®æ ‡çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>$ make help
Usage:
build             Build the application
clean             cleans the binary
run               runs go run main.go
docker-build      builds docker image
docker-push       pushes the docker image
setup             set up modules
help              prints this help message
è¿™äº›æ¶ˆæ¯å¾ˆæœ‰å¸®åŠ©ï¼Œå¯¹äºå…¶ä»–äººç”šè‡³æœ‰æ—¶å¯¹è‡ªå·±éƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„æç¤ºã€‚</p>
<p>Conclusion ç»“è®º
Makeæ˜¯ä¸€ä¸ªç®€å•ä½†å¯é«˜åº¦é…ç½®çš„å·¥å…·ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨éå†äº†makeæä¾›çš„è®¸å¤šé…ç½®å’ŒåŠŸèƒ½ï¼Œä»è€Œä¸ºGoåº”ç”¨ç¨‹åºç¼–å†™äº†æœ‰æ•ˆè€Œé«˜æ•ˆçš„Makefileã€‚</p>
<p>ä¸‹é¢æ˜¯å®Œæ•´çš„Makefileï¼Œå…¶ä¸­æ·»åŠ äº†ä¸€äº›çç¢çš„è§„åˆ™å’Œå˜é‡ï¼š</p>
<p>GO111MODULES=on
APP?=stringifier
REGISTRY?=gcr.io/images
COMMIT_SHA=$(shell git rev-parse &ndash;short HEAD)</p>
<p>.PHONY: build</p>
<h2 id="build-build-the-application-1">build: build the application</h2>
<p>build: clean
@echo &ldquo;Building&hellip;&rdquo;
@go build -o ${APP} main.go</p>
<p>.PHONY: run</p>
<h2 id="run-runs-go-run-maingo-1">run: runs go run main.go</h2>
<p>run:
go run -race main.go</p>
<p>.PHONY: clean</p>
<h2 id="clean-cleans-the-binary-1">clean: cleans the binary</h2>
<p>clean:
@echo &ldquo;Cleaning&rdquo;
@go clean</p>
<p>.PHONY: test</p>
<h2 id="test-runs-go-test-with-default-values">test: runs go test with default values</h2>
<p>test:
go test -v -count=1 -race ./&hellip;</p>
<p>.PHONY: build-tokenizer</p>
<h2 id="build-tokenizer-build-the-tokenizer-application">build-tokenizer: build the tokenizer application</h2>
<p>build-tokenizer:
${MAKE} -c tokenizer build</p>
<p>.PHONY: setup</p>
<h2 id="setup-setup-go-modules-1">setup: setup go modules</h2>
<p>setup:
@go mod init <br>
&amp;&amp; go mod tidy <br>
&amp;&amp; go mod vendor</p>
<h1 id="helper-rule-for-deployment">helper rule for deployment</h1>
<p>check-environment:
ifndef ENV
$(error ENV not set, allowed values - <code>staging</code> or <code>production</code>)
endif</p>
<p>.PHONY: docker-build</p>
<h2 id="docker-build-builds-the-stringifier-docker-image-to-registry">docker-build: builds the stringifier docker image to registry</h2>
<p>docker-build: build
docker build -t ${APP}:${COMMIT_SHA} .</p>
<p>.PHONY: docker-push</p>
<h2 id="docker-push-pushes-the-stringifier-docker-image-to-registry">docker-push: pushes the stringifier docker image to registry</h2>
<p>docker-push: check-environment docker-build
docker push ${REGISTRY}/${ENV}/${APP}:${COMMIT_SHA}</p>
<p>.PHONY: help</p>
<h2 id="help-prints-this-help-message-1">help: Prints this help message</h2>
<p>help:
@echo &ldquo;Usage: \n&rdquo;
@sed -n &rsquo;s/^##//p&rsquo; ${MAKEFILE_LIST} | column -t -s &lsquo;:&rsquo; |  sed -e &rsquo;s/^/ /&rsquo;
Refer to:</p>
<p><a href="https://danishpraka.sh/2019/12/07/using-makefiles-for-go.html">https://danishpraka.sh/2019/12/07/using-makefiles-for-go.html</a>
<a href="https://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets">https://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets</a></p>
<p><a href="https://colynn.github.io/2020-03-03-using_makefile/">https://colynn.github.io/2020-03-03-using_makefile/</a></p>

    </main>
  </section>

  

  
  <div class="divider max-w-[65ch] mx-auto"></div>
  

  <section class="max-w-[65ch] mx-auto space-y-4">
    

    
    <template x-if="['localhost', '127.0.0.1'].indexOf(window.location.hostname) == -1">
      <article>
        <script
          src="https://utteranc.es/client.js"
          repo="arnocat/arnocat.github.io"
          issue-term="og:title"
          theme="github-light"
          crossorigin="anonymous"
          async>
        </script>
      </article>
    </template>
    

    
  </section>
</div>


            <footer class="flex justify-between items-center gap-2 px-4 py-12">
              <div>
  
  <p>
    Â© 2016 - 2024 Arno
  </p>
  

  
  <p class="text-sm">
    ğŸŒ±
    <span class="text-base-content/60">
      Powered by <a class="hover:underline" href="https://gohugo.io/" target="_blank">Hugo</a> with theme
      <a class="hover:underline" href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</span
    >
  </p>
  
</div>

              <div
  x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center h-[32px] px-2 gap-2 border border-base-300 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

            </footer>
          </div>
        </section>
        <section class="back">
          <div class="container">
            <div class="dream-grid">
  
  
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">About Me</div>

        <div class="prose dark:prose-invert">
          <p>Cut out summary from your post content here.</p>
<p>The remaining content of your post.</p>
        </div>
      </div>
    </article>
  </div>
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">Copyright</div>

        <div class="prose dark:prose-invert">
          <p>Cut out summary from your post content here.</p>
<p>The remaining content of your post.</p>
        </div>
      </div>
    </article>
  </div>
  
  

  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">ç¤¾äº¤é“¾æ¥</div>

        <ul class="menu menu-horizontal flex-wrap w-full [&_ion-icon]:text-lg">
  
  <li>
    <a href="mailto:q243284589@gmail.com" title="Email">
      <ion-icon name="mail"></ion-icon>
    </a>
  </li>
  

  
  <li>
    <a href="https://github.com/g1eny0ung" target="_blank" title="GitHub">
      <ion-icon name="logo-github"></ion-icon>
    </a>
  </li>
  
  <li>
    <a href="https://x.com/g1eny0ung" target="_blank" title="X">
      <ion-icon name="logo-x"></ion-icon>
    </a>
  </li>
  
  <li>
    <a href="https://www.linkedin.com/in/g1eny0ung" target="_blank" title="Linkedin">
      <ion-icon name="logo-linkedin"></ion-icon>
    </a>
  </li>
  
  <li>
    <a href="https://stackoverflow.com/users/5676489/g1eny0ung" target="_blank" title="stack overflow">
      <ion-icon name="logo-stackoverflow"></ion-icon>
    </a>
  </li>
  
</ul>

      </div>
    </article>
  </div>
  

  
  
</div>

          </div>
        </section>
      </div>
    </div>

    <script>
  window.lightTheme = "emerald"
  window.darkTheme = "forest"

  window.hasTwitterEmbed =  null 
  if (window.hasTwitterEmbed) {
    
    window.twttr = (function (d, s, id) {
      var js,
        fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {}
      if (d.getElementById(id)) return t
      js = d.createElement(s)
      js.id = id
      js.src = 'https://platform.twitter.com/widgets.js'
      fjs.parentNode.insertBefore(js, fjs)

      t._e = []
      t.ready = function (f) {
        t._e.push(f)
      }

      return t
    })(document, 'script', 'twitter-wjs')
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
<script src="/js/grid.js"></script>
<script src="/js/main.js"></script>

    


<script
  src="https://cdn.jsdelivr.net/npm/luxon@1.26.0"
  integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0="
  crossorigin="anonymous"
></script>
<script>
  format()

  function format() {
    document.querySelectorAll('span[data-format="luxon"]').forEach(el => {
      const date = el.textContent

      el.textContent = luxon.DateTime.fromISO(date, { locale: "zh" }).toFormat("yyyyå¹´MMæœˆddæ—¥")
    })
  }
</script>



<script>
  window.customSyntaxHighlighting = {
    light: "/css/syntax-light.min.css",
    dark: "/css/syntax-dark.min.css"
  }

  document.addEventListener('alpine:initialized', () => {
    var isDark = Alpine.store('darkMode').isDark()
    var customSyntaxHighlightingUrl = isDark ? window.customSyntaxHighlighting.dark : window.customSyntaxHighlighting.light

    document
      .querySelector('link[data-custom-syntax-highlighting]')
      .setAttribute('href', customSyntaxHighlightingUrl)
  })
</script>




    

    

    <script type="module" src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js"></script>
  </body>
</html>
